<!-- NUEVA PUBLICACIÓN -->
<form [formGroup]="formPublicacion" (ngSubmit)="publicar()" enctype="multipart/form-data">
  <mat-form-field appearance="fill" class="main__nueva-publicacion-titulo">
    <input matInput placeholder="Título de la publicación" formControlName="titulo">
  </mat-form-field>

  <mat-form-field appearance="fill" class="main__nueva-publicacion-textarea">
    <textarea matInput placeholder="¿Qué estás pensando?" formControlName="contenido"></textarea>
  </mat-form-field>
    <mat-form-field appearance="fill">
    <mat-label>Categoría</mat-label>
    <mat-select [(value)]="idCategoriaSeleccionada" required>
    <mat-option *ngFor="let cat of categorias" [value]="cat.id">
        {{ cat.nombreCategoria }}
    </mat-option>
    </mat-select>
</mat-form-field>
  <!-- INPUT PARA IMAGEN -->
  <!-- INPUT oculto -->
<input
  type="file"
  #fileInput
  style="display: none"
  accept="image/*"
  (change)="onFileSelected($event)"
/>


  <div class="main__nueva-publicacion-actions">
    <div>
      <!-- BOTÓN visible con ícono -->
        <button mat-icon-button type="button" (click)="fileInput.click()" matTooltip="Seleccionar imagen">
        <mat-icon>image</mat-icon>
        </button>
        <div class="preview-container" *ngIf="imagenSeleccionada">
            <div class="preview-header">
                <span class="preview-nombre">{{ imagenSeleccionada.name }}</span>
                <button mat-icon-button color="warn" (click)="quitarImagen()" matTooltip="Eliminar imagen seleccionada">
                <mat-icon>close</mat-icon>
                </button>
            </div>
            <img [src]="previewUrl" alt="Vista previa" class="preview-img" />
        </div>
    </div>
    <div>
      <button mat-raised-button color="primary" type="submit" [disabled]="formPublicacion.invalid">Publicar</button>
    </div>
  </div>
</form>

<!-- FEED DE PUBLICACIONES -->
<div class="feed-container">
  <div class="publicacion mat-elevation-z2" *ngFor="let pub of publicaciones">
    <div class="publicacion-header">
      <span>{{ pub.usuarioEmail }}</span>
      <span>{{ pub.fecha | date: 'dd/MM/yyyy HH:mm' }}</span>
    </div>

    <img
        *ngIf="pub.imagenUrl"
        [src]="'http://localhost:8080' + pub.imagenUrl"
        alt="Imagen de la publicación"
        class="publicacion-imagen"
    />


    <div class="publicacion-contenido">
      <h3 *ngIf="pub.titulo">{{ pub.titulo }}</h3>
      <p>{{ pub.contenido }}</p>
    </div>

    <div class="publicacion-footer">
      <button mat-icon-button><mat-icon>favorite</mat-icon></button>
      <button mat-icon-button><mat-icon>chat</mat-icon></button>
      <button mat-icon-button><mat-icon>share</mat-icon></button>

      <!-- Mostrar botón eliminar solo si el post es del usuario (lógica a definir) -->
      <button mat-icon-button color="warn" (click)="eliminar(pub.idPublicacion)">
        <mat-icon>delete</mat-icon>
      </button>
    </div>
  </div>
</div>

